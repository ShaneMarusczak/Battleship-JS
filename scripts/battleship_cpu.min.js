"use strict";var compMoveWindow,gameOver=!1,gameStarted=!1;(()=>{let shipFound=0,shipsPlaced=0,lastShotX,lastShotY,placed,size,allShipsPlaced=!1,placedCarrier=!1,placedBattleship=!1,placedCruiser=!1,placedSubmarine=!1,placedDetroyer=!1,carrierSunk=!1,battleshipSunk=!1,cruiserSunk=!1,submarineSunk=!1,destroyerSunk=!1,shipDirection="",scanCounter=0,direction="hor",shotsfired=0;const rows=10,cols=10,cellSize=50,gameBoard=[],gameBoardContainer=document.getElementById("gameboard_cpu"),carrier=document.getElementById("carrier"),battleship=document.getElementById("battleship"),cruiser=document.getElementById("cruiser"),submarine=document.getElementById("submarine"),destroyer=document.getElementById("destroyer"),sunkSound=new Audio("static/Ship Sunk Sound.mp3"),placedShips=[],ships=[carrier,battleship,cruiser,submarine,destroyer],probabilityChart=[],sunkPhrases=["I am winning!","Found You!","You're Sunk!","Down she goes!","Gotcha!","Ha Ha!","I'm the best!","Woo Hoo!","I'm Better!","I'm gonna win!","Easy!","Sink that ship!","Try Harder!","Yawn..","Sunk!","Oh Yeah!"],getCId=(x,y)=>"c"+x+y,sleep=ms=>new Promise(resolve=>setTimeout(resolve,ms)),capitalizeFirst=str=>str.charAt(0).toUpperCase()+str.slice(1),alertModalControl=(message,duration)=>{document.getElementById("alertshader").style.display="block",document.getElementById("alertmessage").innerText=message,sleep(duration).then(()=>{document.getElementById("alertshader").style.display="none"})},randomIntFromInterval=(min,max)=>Math.floor(Math.random()*(max-min+1)+min),shipSunkHelper=(num,sunkShipName)=>{sunkSound.play(),document.getElementById(sunkShipName+"Sunk_cpu").classList.add("sunkText"),sunkColorChange(sunkShipName),shipFound-=num,shipDirection="";for(let i=0;i<10;i++)for(let j=0;j<10;j++)isShip(i,j,sunkShipName)&&(gameBoard[i][j][0]=4);0===randomIntFromInterval(0,10)?alertModalControl(capitalizeFirst(sunkShipName)+" Sunk!",1500):alertModalControl(sunkPhrases[randomIntFromInterval(0,sunkPhrases.length-1)],1500),shipFound>0&&shipHitButNotSunkReassign()},rotateShip=()=>{for(let i=0;i<10;i++)for(let j=0;j<10;j++)"hor"==direction?(document.getElementById(getCId(i,j)).removeEventListener("mouseover",highlight),document.getElementById(getCId(i,j)).addEventListener("mouseover",rotatedHighlight)):(document.getElementById(getCId(i,j)).removeEventListener("mouseover",rotatedHighlight),document.getElementById(getCId(i,j)).addEventListener("mouseover",highlight));direction="hor"==direction?"ver":"hor"},rotatedHighlight=e=>{const elemId=e.target.id;if(Number(elemId[1])<11-size){for(let i=0;i<10;i++)for(let j=0;j<10;j++)document.getElementById(getCId(i,j)).addEventListener("click",placeShip);for(let i=0;i<size;i++)document.getElementById(elemId[0]+(Number(elemId[1])+i)+elemId[2]).style.background="black"}else for(let i=0;i<10;i++)for(let j=0;j<10;j++)document.getElementById(getCId(i,j)).removeEventListener("click",placeShip)},highlight=e=>{const elemId=e.target.id;if(Number(elemId[2])<11-size){for(let i=0;i<10;i++)for(let j=0;j<10;j++)document.getElementById(getCId(i,j)).addEventListener("click",placeShip);for(let i=0;i<size;i++)document.getElementById(elemId[0]+elemId[1]+(Number(elemId[2])+i)).style.background="black"}else for(let i=0;i<10;i++)for(let j=0;j<10;j++)document.getElementById(getCId(i,j)).removeEventListener("click",placeShip)},resetColor=()=>{for(let i=0;i<10;i++)for(let j=0;j<10;j++)isMiss(i,j)&&(document.getElementById(getCId(i,j)).style.background="#80aaff")},placeShip=e=>{if(allShipsPlaced)return;const ship=[];let canPlace=!0;const x=Number(e.target.id[1]),y=Number(e.target.id[2]);for(const placedShip of placedShips)for(const coor of placedShip)if("hor"===direction)for(let i=0;i<size;i++)x===coor[0]&&y+i===coor[1]&&(canPlace=!1);else for(let i=0;i<size;i++)x+i===coor[0]&&y===coor[1]&&(canPlace=!1);if(canPlace||alertModalControl("Can't place here!",1400),canPlace){for(let i=0;i<10;i++)for(let j=0;j<10;j++)"black"==document.getElementById(getCId(i,j)).style.background&&""==gameBoard[i][j][1]&&(5===size?gameBoard[i][j][1]="carrier":4===size?gameBoard[i][j][1]="battleship":3===size&&"cruiser"===placed?gameBoard[i][j][1]="cruiser":3===size&&"submarine"===placed?gameBoard[i][j][1]="submarine":2===size&&(gameBoard[i][j][1]="destroyer"),document.getElementById(getCId(i,j)).removeEventListener("mouseover",highlight),gameBoard[i][j][0]=1,ship.push([i,j]));if(5===size?(placedCarrier=!0,shipsPlaced++,document.getElementById("carrier").classList.add("notDisplayed")):4===size?(placedBattleship=!0,shipsPlaced++,document.getElementById("battleship").classList.add("notDisplayed")):3===size?"cruiser"===placed?(placedCruiser=!0,shipsPlaced++,document.getElementById("cruiser").classList.add("notDisplayed")):"submarine"===placed&&(placedSubmarine=!0,shipsPlaced++,document.getElementById("submarine").classList.add("notDisplayed")):2===size&&(placedDetroyer=!0,shipsPlaced++,document.getElementById("destroyer").classList.add("notDisplayed")),5===shipsPlaced){document.getElementById("downArrow").classList.add("notDisplayed"),document.getElementById("leftList").classList.remove("notDisplayed"),document.getElementById("ships").classList.add("notDisplayed"),alertModalControl("All ships Placed!",1400),allShipsPlaced=!0,gameStarted=!0;for(let i=0;i<10;i++)for(let j=0;j<10;j++)document.getElementById(getCId(i,j)).removeEventListener("mouseleave",resetColor)}size=0,placedShips.push(ship)}},isShip=(x,y,shipName)=>gameBoard[x][y][1]===shipName,shipSunkChecker=()=>{let carrierCounter=0,battleshipCounter=0,cruiserCounter=0,submarineCounter=0,destroyerCounter=0;for(let i=0;i<10;i++)for(let j=0;j<10;j++)isShip(i,j,"carrier")&&isAlreadyHit(i,j)&&!carrierSunk?carrierCounter++:isShip(i,j,"battleship")&&isAlreadyHit(i,j)&&!battleshipSunk?battleshipCounter++:isShip(i,j,"cruiser")&&isAlreadyHit(i,j)&&!cruiserSunk?cruiserCounter++:isShip(i,j,"submarine")&&isAlreadyHit(i,j)&&!submarineSunk?submarineCounter++:isShip(i,j,"destroyer")&&isAlreadyHit(i,j)&&!destroyerSunk&&destroyerCounter++;5==carrierCounter&&(carrierSunk=!0,shipSunkHelper(5,"carrier")),4==battleshipCounter&&(battleshipSunk=!0,shipSunkHelper(4,"battleship")),3==cruiserCounter&&(cruiserSunk=!0,shipSunkHelper(3,"cruiser")),3==submarineCounter&&(submarineSunk=!0,shipSunkHelper(3,"submarine")),2==destroyerCounter&&(destroyerSunk=!0,shipSunkHelper(2,"destroyer"))},allShips=["carrier","battleship","cruiser","submarine","destroyer"],placeShipSetup=e=>{const elemId=e.target.parentElement.id;if(document.getElementById(elemId).classList.contains("clicked"))return document.getElementById(elemId).classList.remove("clicked"),void(size=0);allShips.forEach(s=>document.getElementById(s).classList.remove("clicked")),"carrier"!==elemId||placedCarrier?"battleship"!==elemId||placedBattleship?"cruiser"!==elemId||placedCruiser?"submarine"!==elemId||placedSubmarine?"destroyer"!==elemId||placedDetroyer||(size=2,e.target.parentElement.classList.add("clicked")):(size=3,e.target.parentElement.classList.add("clicked"),placed="submarine"):(size=3,e.target.parentElement.classList.add("clicked"),placed="cruiser"):(size=4,e.target.parentElement.classList.add("clicked")):(size=5,e.target.parentElement.classList.add("clicked"))},gaveOverChecker=()=>{carrierSunk&&battleshipSunk&&cruiserSunk&&submarineSunk&&destroyerSunk&&(document.getElementById("losstext").style.display="block",gameOver=!0,gameOverColorChange(),sleep(1500).then(()=>alertModalControl("HA HA! I WIN!",2e3)))},shipFoundAttack=()=>{const x=lastShotX,y=lastShotY;if("ver"==shipDirection){if(x+1<=9){if(isMiss(x+1,y))return void missHelper(x+1,y);if(isHit(x+1,y))return hitHelper(x+1,y),void lastShotX++}if(x+1>9||alreadyFiredAt(x+1,y)){for(let i=1;i<10&&!(x-i<0||3==gameBoard[x-i][y][0]||4==gameBoard[x-i][y][0]);i++){if(isMiss(x-i,y))return void missHelper(x-i,y);if(isHit(x-i,y))return void hitHelper(x-i,y)}scanCounter=0,shipDirection=""}}if("hor"==shipDirection){if(y+1<=9){if(isMiss(x,y+1))return void missHelper(x,y+1);if(isHit(x,y+1))return hitHelper(x,y+1),void lastShotY++}if(y+1>9||alreadyFiredAt(x,y+1)){for(let i=1;i<10&&!(y-i<0||3===gameBoard[x][y-i][0]||4===gameBoard[x][y-i][0]);i++){if(isMiss(x,y-i))return void missHelper(x,y-i);if(isHit(x,y-i))return void hitHelper(x,y-i)}scanCounter=0,shipDirection=""}}if(0===scanCounter&&""===shipDirection)if(x+1>9)scanCounter++;else{if(isMiss(x+1,y))return missHelper(x+1,y),void scanCounter++;if(isHit(x+1,y))return hitHelper(x+1,y),shipDirection="ver",scanCounter=0,void lastShotX++;scanCounter++}if(1===scanCounter&&""===shipDirection)if(y+1>9)scanCounter++;else{if(isMiss(x,y+1))return missHelper(x,y+1),void scanCounter++;if(isHit(x,y+1))return hitHelper(x,y+1),shipDirection="hor",scanCounter=0,void lastShotY++;scanCounter++}if(2===scanCounter&&""===shipDirection)if(x-1<0)scanCounter++;else{if(isMiss(x-1,y))return missHelper(x-1,y),void scanCounter++;if(isHit(x-1,y))return hitHelper(x-1,y),shipDirection="ver",scanCounter=0,void lastShotX--;scanCounter++}if(3===scanCounter&&""===shipDirection){if(isMiss(x,y-1))return missHelper(x,y-1),void scanCounter++;if(isHit(x,y-1))return hitHelper(x,y-1),shipDirection="hor",scanCounter=0,void lastShotY--}},isMiss=(x,y)=>0===gameBoard[x][y][0],isHit=(x,y)=>1===gameBoard[x][y][0],isAlreadyHit=(x,y)=>2===gameBoard[x][y][0],alreadyFiredAt=(x,y)=>gameBoard[x][y][0]>1,hitHelper=(x,y)=>{document.getElementById(getCId(x,y)).style.background="red",gameBoard[x][y][0]=2,shipFound++,shotsfired++},missHelper=(x,y)=>{document.getElementById(getCId(x,y)).style.background="#4d88ff",gameBoard[x][y][0]=3,shotsfired++},searchingShot=()=>{let x,y;if(shotsfired<5||0===randomIntFromInterval(0,5))do{x=randomIntFromInterval(0,8),y=randomIntFromInterval(0,8)}while(x%2!=0&&y%2==0||x%2==0&&y%2!=0);else[x,y]=probabilityCalculator(),resetProbabilityChart();lastShotX=x,lastShotY=y,isMiss(x,y)?missHelper(x,y):isHit(x,y)?hitHelper(x,y):alreadyFiredAt(x,y)&&searchingShot()},compMove=()=>{!gameOver&&gameStarted&&(allShipsPlaced?(shipFound>0?shipFoundAttack():searchingShot(),shipSunkChecker(),gaveOverChecker()):alertModalControl("Place all ships!",1400))},shipHitButNotSunkReassign=()=>{for(let i=0;i<10;i++)for(let j=0;j<10;j++)if(isAlreadyHit(i,j))return lastShotX=i,void(lastShotY=j)},sunkColorChange=shipName=>{for(let i=0;i<10;i++)for(let j=0;j<10;j++)isShip(i,j,shipName)&&isAlreadyHit(i,j)&&(document.getElementById(getCId(i,j)).style.background="darkred")},probabilityCalculator=()=>{const lengthsLeft=[];let counter=0;carrierSunk||lengthsLeft.push(5),battleshipSunk||lengthsLeft.push(4),submarineSunk||lengthsLeft.push(3),cruiserSunk||lengthsLeft.push(3),destroyerSunk||lengthsLeft.push(2);for(let n=0;n<lengthsLeft.length;n++){for(let i=0;i<10;i++)for(let j=0;j<10-lengthsLeft[n]+1;j++){for(let k=0;k<lengthsLeft[n];k++)alreadyFiredAt(i,j+k)||counter++;if(counter===lengthsLeft[n])for(let k=0;k<lengthsLeft[n];k++)probabilityChart[i][j+k]++;counter=0}for(let i=0;i<10;i++)for(let j=0;j<10-lengthsLeft[n]+1;j++){for(let k=0;k<lengthsLeft[n];k++)alreadyFiredAt(j+k,i)||counter++;if(counter===lengthsLeft[n])for(let k=0;k<lengthsLeft[n];k++)probabilityChart[j+k][i]++;counter=0}}let currentMax=0,x,y;for(let i=0;i<10;i++)for(let j=0;j<10;j++)probabilityChart[i][j]>currentMax&&(currentMax=probabilityChart[i][j],x=i,y=j);return[x,y]},resetProbabilityChart=()=>{for(let i=0;i<10;i++)for(let j=0;j<10;j++)probabilityChart[i][j]=0},gameOverColorChange=()=>{for(let i=0;i<10;i++)for(let j=0;j<10;j++)1===window.exportedGameBoard[i][j][0]&&document.getElementById("s"+i+j).classList.add("blackBackground")},rotateIcon=()=>{document.getElementsByClassName("rotateArrow")[0].classList.add("rotateAnimation"),document.getElementsByClassName("rotateArrow")[0].classList.remove("rotateBackAnimation")},rotateIconBack=()=>{document.getElementsByClassName("rotateArrow")[0].classList.remove("rotateAnimation"),document.getElementsByClassName("rotateArrow")[0].classList.add("rotateBackAnimation")};(()=>{compMoveWindow=compMove;for(let i=0;i<10;i++){gameBoard.push([]),probabilityChart.push([]);for(let j=0;j<10;j++){probabilityChart[i].push(0),gameBoard[i].push([0,""]);const cell=document.createElement("div");gameBoardContainer.appendChild(cell),cell.id="c"+j+i;const topPosition=50*j+5,leftPosition=50*i+5;cell.style.top=topPosition+"px",cell.style.left=leftPosition+"px",cell.style.background="#80aaff",cell.addEventListener("mouseover",highlight),cell.addEventListener("mouseleave",resetColor)}}ships.forEach(s=>s.addEventListener("click",placeShipSetup)),document.getElementById("rotate").addEventListener("mouseover",rotateIcon),document.getElementById("rotate").addEventListener("mouseleave",rotateIconBack),document.getElementById("rotate").addEventListener("click",rotateShip),document.getElementById("strtOvrBtn").addEventListener("click",()=>location.reload()),document.addEventListener("keydown",(function(event){192==event.keyCode&&console.log(gameBoard)}))})()})();